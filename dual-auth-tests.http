### IdentityServer Tests
### Test Client Credentials flow

# Get service token from IdentityServer
POST https://localhost:5005/connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&client_id=api-gateway&client_secret=gateway-secret-key&scope=inventory.api bookings.api users.api payments.api

###

# Test with booking service token
POST https://localhost:5005/connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&client_id=booking-service&client_secret=booking-secret&scope=inventory.api users.api

###

### API Gateway Tests
### Test user authentication through Gateway

# Register new user
POST https://localhost:5000/api/v1/auth/register
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "TestPassword123!",
  "firstName": "Test",
  "lastName": "User",
  "role": "Customer"
}

###

# Login user
POST https://localhost:5000/api/v1/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "TestPassword123!"
}

###

# Test protected endpoint with user JWT token
GET https://localhost:5000/api/v1/auth/me
Authorization: Bearer {{userToken}}

###

### Microservices Tests
### Test service-to-service communication

# Test Booking Service with Client Credentials token
GET https://localhost:5001/api/v1/bookings
Authorization: Bearer {{serviceToken}}

###

# Test Inventory Service with Client Credentials token
GET https://localhost:5002/api/v1/resources
Authorization: Bearer {{serviceToken}}

###

# Test Payment Service with Client Credentials token
GET https://localhost:5003/api/v1/payments
Authorization: Bearer {{serviceToken}}

###

# Test User Service with Client Credentials token
GET https://localhost:5004/api/v1/users/{{userId}}
Authorization: Bearer {{serviceToken}}

###

### Test without authentication (should fail)

# Test Booking Service without token
GET https://localhost:5001/api/v1/bookings

###

# Test Inventory Service without token
GET https://localhost:5002/api/v1/resources

###

# Test Payment Service without token
GET https://localhost:5003/api/v1/payments

###

# Test User Service without token
GET https://localhost:5004/api/v1/users/{{userId}}

###
